《你不知道的JS》上卷 第一部分 作用域和闭包

# 第一章 作用域是什么

**储存**和**访问**变量的值的能力带给程序不同的状态。JS里储存变量的规则就是作用域，在作用域内可以方便的找到变量。

## 1. 编译原理

传统语言的流程中，程序的源代码在执行前会经历三个步骤，叫做编译：

- 分词/词法分析：代码分解成代码块
- 解析/语法分析：根据代码块生成AST
- 代码生成：将AST转换成计算机可执行的代码

JS的编译过程要复杂的多，是一边执行，一边编译。

## 2. 理解作用域

**引擎**：负责整个JS程序的编译和执行过程。

**编译器**：负责语法分析及代码生成等脏活累活。

**作用域**：负责收集并维护所有标识符组成的一系列查询，确定当前执行的代码对标识符的访问权限。

变量的赋值操作会执行如下两个动作：**首先编译器会在当前作用域中声明一个变量；然后JS引擎在运行时会在作用域中查找这个变量，并赋值。**

## 3. 作用域嵌套

作用域是根据名称查找变量的一套规则。当一个块或函数嵌套在另一个块或函数中，就发生了作用域嵌套。

遍历嵌套作用域链的规则是：引擎从当前的执行作用域开始查找变量，如果找不到，就向上一级查找，当抵达最外层的全局作用域时，查找就会停止。

## 4. 异常

ReferenceError同作用域判别失败相关，而TypeError则代表作用域判别成功了，但是对结果的操作是非法或不合理的。

## 5. 总结

作用域是一套规则，用于查找变量，如果查找的变量是对变量赋值，则使用LHS查询；如果目的是获取变量的值，则使用RHS查询。






