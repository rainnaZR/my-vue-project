《图解HTTP》阅读总结：

# 第九章 基于HTTP的功能追加协议

### 1. HTTP标准瓶颈

**HTTP标准的瓶颈：**

1）一条连接上只可发送一个请求。

2）请求只能从客户端开始。客户端不可以接收除响应以外的指令。

3）请求/响应首部未经压缩就发送。首部信息越多延迟越大。

4）发送冗长的首部。每次发送相同的首部浪费较多。

5）可任意选择数据压缩格式。

**Ajax的解决办法：**

利用Ajax实时的从服务器获取内容，有可能会导致大量请求产生。

**Comet的解决办法：**

一旦服务端有内容更新，Comet不会让请求等待，而是直接给客户端响应。为了实现推送功能，Comet会先将响应置于挂起状态，为了保留响应，连接的持续时间变长了，为了维持连接所消耗的资源也会更多。

### 2. SPDY

**SPDY的设计：**

SPDY可以消除HTTP瓶颈，它没有完全改写HTTP协议，而是在TCP/IP的应用层和传输层之间新加会话层运作。同时SPDY协议规定通信中使用SSL。

SPDY以会话层的形式加入，控制对数据的流动，但还是采用HTTP建立通信连接。使用SPDY协议后，新增如下功能：

**1）多路复用流**

通过单一的TCP连接，可以无限制的处理多个HTTP请求。TCP处理效率增加。

**2）赋予请求优先级**

SPDY可以给请求分配优先级顺序。

**3）压缩HTTP首部**

压缩HTTP请求和响应的首部。

**4）推送功能**

支持服务器主动向客户端推送数据的功能。

**5）服务器提示功能**

服务器可以主动提示客户端请求所需的资源。提前发现缓存在客户端的资源，避免不必要请求的发送。

SPDY协议只是将单个域名的通信多路复用，当网站上有多个域名存在时，优化效果受限。



### 3. WebSocket

WebSocket可以使用浏览器进行全双工通信。一旦服务器与客户端之间建立WebSocket协议的通信连接，之后所有的通信都会依靠这个专用协议进行。WebSocket是在HTTP基础上建立的协议，由客户端发起，一旦确立WebSocket连接，不论服务器还是客户端，任意一方都可以向对方发送报文。

WebSocket协议特点：

**1）推送功能**

支持由服务器向客户端推送数据的推送功能。

**2）减少通信量**

只要建立起WebSocket连接，就会一直保持连接状态。

为了实现WebSocket通信，需要用到HTTP的Upgrade首部字段，告知服务器通信协议发生改变。成功握手确立WebSocket连接后，通信时不再使用HTTP的数据帧，而是WebSocket独立的数据帧。


```
var socket = new WebSocket('ws://game.com');
socket.onopen = function(){
    setInterval(function(){
        if(socket.bufferedAmount == 0){
            socket.send(getUpdateData());
        ]
    }, 50)
};
```


### 4. HTTP2

HTTP2建立在SPDY和WebSocket基础之上。存在7个讨论。

1）多路复用

2）TLS义务化

3）协商

4）服务器推送

5）流量控制

6）WebSocket

### 5. WebDAV

WebDAV基于万维网的分布式创作和版本控制，是一个可对WEB服务器上的内容直接进行文件复制，编辑等操作的分布式操作系统。WebDAV客户端直接对服务器上的文件进行操作。



