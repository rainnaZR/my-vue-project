
# 经验总结-特点

## 脚本加载顺序问题
组件脚本加载和组件实例化顺序的处理方式。组件执行完后触发组件实例化的方法。

## mock数据定义灵活
根据配置项灵活生成组件配置数据，模块配置数据

## 根据不同的浏览器端动态加载文件
利用条件判断 import 不同的文件
解决办法： 利用继承的写法，提取公共部分，再通过继承引入不同的文件。

## 后端的数据缓存方案
ftl缓存， 页面框架数据缓存，区块数据缓存，首屏数据缓存

## 呈现系统的宏定义不能和主站的宏定义冲突
现象: h5的活动页面显示了两个meta信息

## postMessage() 和 message() 方法的冲突
现象: 呈现系统页面PC登录弹窗报错。window上的message事件被频繁触发，事件执行时传回的数据格式错误导致报错。

原因：呈现系统的PC活动页因为有一个接口要解决跨域问题，使用iframe来获取数据，其中用到了postMessage()方法，所以在主页脚本里定义了message事件。
结果会导致该页面上所有iframe里的脚本只要执行postMessage(),都会触发外面的message事件。而登录弹窗就满足这种条件。

message方法是写在NEJ里的，只要对数据进行格式判断，或者对域名做限制，都是能够解决的。就是要改NEJ的代码了。

## X-Frame-Options的使用
https://developer.mozilla.org/zh-CN/docs/Web/HTTP/X-Frame-Options

## 登录问题总结
1. postMessage()和message()的合理使用，使用升级NEJ包来解决。
2. iframe做代理，没有跳转，原因是www.kaola.com加了X-Frame-Options，不允许被嵌入到iframe里面，去掉这个限制后又有跨域问题，不允许通信。最后解决办法还是把loginAgent.htm放到自己工程里。
3. iframe跨域通信与同域通信的解决办法。
4. pc两种登录方式，无刷新登录和刷新登录的处理。


## 解决web工程部署慢的问题。
因为使用了npminstall命令，所以拉下来的包文件特别大，导致打包文件很大，从而导致NOS上传慢，下载慢。
操作应该是：只拉我们需要的模块，比如@kaola/web-ftl,@kaola/wap-ftl, 其他无用的模块不用拉。



## 前端可用的缓存策略 [KJDS-51601](http://jira.netease.com/browse/KJDS-51601)

实现思路：
1. 组件类根据版本号缓存(待调研)
2. 页面框架里的模块配置数据在本地缓存
3. APP内，组件合并接口的返回数据可否存在session storage里。

> 此种方案不可行,原因是每个活动页的数据是不一致的,如果活动页数据较大,则缓存的数据量也非常大,占用内存,得不偿失。



## 活动页面新增同步数据 [KJDS-55311](http://jira.netease.com/browse/KJDS-55311)

实现思路：
通过JSONP请求返回的框架数据里，合并样式的URL，合并脚本的URL，页面标题，分享数据等信息改为同步返回。

> 已上线



## 打包配置修改 [KJDS-55299](http://jira.netease.com/browse/KJDS-55299)

1. 组件脚本里依赖的公共子组件单独打包
2. 对更改较少的组件脚本单独打包

> 已上线


## 模板的占位和loading效果

1. 模块样式添加固定宽高和背景色

